# å…­çˆ»æ’ç›˜ç³»ç»Ÿ - å®Œæ•´é¡¹ç›®æ–‡æ¡£

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [åŠŸèƒ½æ¨¡å—](#åŠŸèƒ½æ¨¡å—)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
6. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
7. [å‰ç«¯ç»„ä»¶è¯´æ˜](#å‰ç«¯ç»„ä»¶è¯´æ˜)
8. [å®‰è£…ä¸éƒ¨ç½²](#å®‰è£…ä¸éƒ¨ç½²)
9. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
10. [æµ‹è¯•è¯´æ˜](#æµ‹è¯•è¯´æ˜)
11. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
12. [æœªæ¥è§„åˆ’](#æœªæ¥è§„åˆ’)

---

## é¡¹ç›®æ¦‚è¿°

### ç®€ä»‹

å…­çˆ»æ’ç›˜ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¼ ç»Ÿå…­çˆ»å åœæ’ç›˜ç³»ç»Ÿï¼Œç»“åˆç°ä»£WebæŠ€æœ¯å’ŒAIæ™ºèƒ½è§£å¦åŠŸèƒ½ã€‚ç³»ç»Ÿæä¾›ä¸‰ç§èµ·å¦æ–¹å¼ï¼ˆæ—¶é—´èµ·å¦ã€æ•°å­—èµ·å¦ã€æ‰‹åŠ¨æ‘‡å¦ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å¦è±¡ä¿¡æ¯ï¼Œå¹¶é€šè¿‡DeepSeek AIæä¾›ä¸“ä¸šçš„è§£å¦åˆ†æã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šç§èµ·å¦æ–¹å¼**ï¼šæ”¯æŒæ—¶é—´ã€æ•°å­—ã€æ‰‹åŠ¨ä¸‰ç§èµ·å¦æ–¹æ³•
- âœ… **å®Œæ•´æ’ç›˜ç³»ç»Ÿ**ï¼šè‡ªåŠ¨è£…çº³ç”²ã€åœ°æ”¯ã€äº”è¡Œã€å…­äº²ã€å…­ç¥
- âœ… **AIæ™ºèƒ½è§£å¦**ï¼šé›†æˆDeepSeek APIè¿›è¡Œä¸“ä¸šè§£å¦åˆ†æ
- âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šMySQL/SQLiteæ•°æ®åº“å­˜å‚¨å†å²è®°å½•
- âœ… **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒPCç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
- âœ… **ä¼ ç»Ÿé£æ ¼**ï¼šä¸­å›½ä¼ ç»Ÿé…è‰²å’ŒUIè®¾è®¡

### åº”ç”¨åœºæ™¯

- ä¼ ç»Ÿæ–‡åŒ–å­¦ä¹ å’Œç ”ç©¶
- å…­çˆ»å åœå®è·µ
- AIè¾…åŠ©å†³ç­–å‚è€ƒ
- å†å²è®°å½•ç®¡ç†å’Œåˆ†æ

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æˆ·ç«¯å±‚ (Client)                    â”‚
â”‚  React + TypeScript + Tailwind CSS                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ èµ·å¦é¡µé¢ â”‚  â”‚ æ’ç›˜é¡µé¢ â”‚  â”‚ å†å²è®°å½• â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æœåŠ¡ç«¯å±‚ (Server)                       â”‚
â”‚  Node.js + Express + TypeScript                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ èµ·å¦æ§åˆ¶å™¨   â”‚  â”‚ AIæ§åˆ¶å™¨     â”‚  â”‚ è®°å½•æ§åˆ¶å™¨   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ å…­çˆ»ç®—æ³•     â”‚  â”‚ æ•°æ®æ¨¡å‹     â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚
         â”‚   MySQLæ•°æ®åº“      â”‚   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚   â”‚ DeepSeek  â”‚
         â”‚ - divination_recordsâ”‚   â”‚    API    â”‚
         â”‚ - trigrams        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ - gua_data        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ¶æ„åˆ†å±‚

#### 1. è¡¨ç°å±‚ (Presentation Layer)
- **æ¡†æ¶**: React 18
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS
- **è·¯ç”±**: React Router v6
- **çŠ¶æ€ç®¡ç†**: React Hooks
- **HTTPå®¢æˆ·ç«¯**: Axios

#### 2. ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- **æ¡†æ¶**: Express.js
- **è¯­è¨€**: TypeScript
- **è·¯ç”±**: Express Router
- **ä¸­é—´ä»¶**: CORS, body-parser
- **å·¥å…·åº“**: lunar-javascript (å†œå†è®¡ç®—)

#### 3. æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- **æ•°æ®åº“**: MySQL 5.7+ / SQLite3
- **ORM**: åŸç”ŸSQLæŸ¥è¯¢
- **è¿æ¥æ± **: mysql2

#### 4. å¤–éƒ¨æœåŠ¡å±‚ (External Services)
- **AIæœåŠ¡**: DeepSeek API
- **é€šä¿¡åè®®**: HTTPS/REST

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| React | 18.x | UIæ¡†æ¶ |
| TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| Vite | 5.x | æ„å»ºå·¥å…· |
| Tailwind CSS | 3.x | æ ·å¼æ¡†æ¶ |
| React Router | 6.x | è·¯ç”±ç®¡ç† |
| Axios | 1.x | HTTPè¯·æ±‚ |

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Node.js | 18+ | è¿è¡Œç¯å¢ƒ |
| Express | 4.x | Webæ¡†æ¶ |
| TypeScript | 5.x | ç±»å‹å®‰å…¨ |
| MySQL | 5.7+ | æ•°æ®åº“ |
| SQLite3 | 5.x | å¼€å‘æ•°æ®åº“ |
| lunar-javascript | 1.x | å†œå†è½¬æ¢ |

### å¼€å‘å·¥å…·

- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **åŒ…ç®¡ç†**: npm
- **ä»£ç è§„èŒƒ**: ESLint, Prettier
- **APIæµ‹è¯•**: Postman, Thunder Client

---

## åŠŸèƒ½æ¨¡å—

### 1. èµ·å¦æ¨¡å—

#### 1.1 æ—¶é—´èµ·å¦æ³•
- ä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´ï¼ˆå†œå†ï¼‰
- ç®—æ³•ï¼šå¹´æœˆæ—¥æ—¶æ•°å€¼ç›¸åŠ å–ä½™æ•°
- è‡ªåŠ¨ç¡®å®šåŠ¨çˆ»ä½ç½®

```typescript
// ç®—æ³•ç¤ºä¾‹
ä¸‹å¦æ•° = (å¹´ + æœˆ + æ—¥) % 8
ä¸Šå¦æ•° = (å¹´ + æœˆ + æ—¥ + æ—¶) % 8
åŠ¨çˆ» = (å¹´ + æœˆ + æ—¥ + æ—¶) % 6
```

#### 1.2 æ•°å­—èµ·å¦æ³•
- ç”¨æˆ·è¾“å…¥ä¸‰ä¸ªæ­£æ•´æ•°
- ç¬¬ä¸€ä¸ªæ•°ç¡®å®šä¸‹å¦
- ç¬¬äºŒä¸ªæ•°ç¡®å®šä¸Šå¦
- ç¬¬ä¸‰ä¸ªæ•°ç¡®å®šåŠ¨çˆ»

```typescript
ä¸‹å¦ = æ•°1 % 8
ä¸Šå¦ = æ•°2 % 8
åŠ¨çˆ» = æ•°3 % 6
```

#### 1.3 æ‰‹åŠ¨æ‘‡å¦æ³•
- æ¨¡æ‹Ÿä¼ ç»Ÿæ‘‡é“œé’±èµ·å¦
- å…­æ¬¡æ‘‡å¦ä»ä¸‹å¾€ä¸Š
- æ¯æ¬¡ç”Ÿæˆè€é˜³/å°‘é˜³/è€é˜´/å°‘é˜´
- è€é˜³å’Œè€é˜´ä¸ºåŠ¨çˆ»

```typescript
// æ¦‚ç‡åˆ†å¸ƒ
è€é˜³(â—‹): 3ä¸ªæ­£é¢ - 25%
å°‘é˜´(--): 2ä¸ªæ­£é¢1ä¸ªåé¢ - 25%
å°‘é˜³(â€”): 1ä¸ªæ­£é¢2ä¸ªåé¢ - 25%
è€é˜´(Ã—): 3ä¸ªåé¢ - 25%
```

### 2. æ’ç›˜æ¨¡å—

#### 2.1 è£…å¦ç³»ç»Ÿ

**çº³ç”²ï¼ˆå¤©å¹²é…ç½®ï¼‰**
- æ ¹æ®å…«å¦ç±»å‹é…ç½®å¤©å¹²
- ä¹¾çº³ç”²å£¬ã€å¤çº³ä¹™ç™¸ç­‰

**åœ°æ”¯é…ç½®**
- æŒ‰ç…§ä¼ ç»Ÿå…­çˆ»è§„åˆ™é…ç½®åäºŒåœ°æ”¯
- ä»åˆçˆ»åˆ°ä¸Šçˆ»ä¾æ¬¡é…ç½®

**äº”è¡Œé…ç½®**
- æ ¹æ®åœ°æ”¯ç¡®å®šäº”è¡Œå±æ€§
- é‡‘æœ¨æ°´ç«åœŸäº”è¡Œç›¸ç”Ÿç›¸å…‹

**å…­äº²é…ç½®**
- çˆ¶æ¯ã€å…„å¼Ÿã€å­å­™ã€å¦»è´¢ã€å®˜é¬¼
- æ ¹æ®å¦å®«å’Œäº”è¡Œå…³ç³»ç¡®å®š

**å…­ç¥é…ç½®**
- é’é¾™ã€æœ±é›€ã€å‹¾é™ˆã€è£è›‡ã€ç™½è™ã€ç„æ­¦
- æ ¹æ®æ—¥æœŸåœ°æ”¯ç¡®å®šèµ·å§‹å…­ç¥

**ä¸–åº”ä½ç½®**
- æ ¹æ®å…«å®«å¦åºç¡®å®šä¸–çˆ»ä½ç½®
- åº”çˆ»ä½ç½® = (ä¸–çˆ»ä½ç½® + 3) % 6

#### 2.2 æœ¬å¦ä¸å˜å¦
- **æœ¬å¦**: åŸå§‹èµ·å¦ç»“æœ
- **å˜å¦**: åŠ¨çˆ»å˜åŒ–åçš„å¦è±¡
- è€é˜³å˜å°‘é˜´ï¼Œè€é˜´å˜å°‘é˜³

### 3. AIè§£å¦æ¨¡å—

#### 3.1 DeepSeeké›†æˆ
- ä½¿ç”¨DeepSeek APIè¿›è¡Œæ™ºèƒ½è§£æ
- æµå¼å“åº”æå‡ç”¨æˆ·ä½“éªŒ
- åŸºäºå®Œæ•´å¦è±¡ä¿¡æ¯åˆ†æ

#### 3.2 è§£å¦å†…å®¹
- å¦è±¡æ€»ä½“åˆ†æ
- åŠ¨çˆ»å«ä¹‰è§£è¯»
- ç”¨ç¥ã€åŸç¥ã€å¿Œç¥åˆ†æ
- æ—¶ç©ºå› ç´ è€ƒè™‘
- å…·ä½“å»ºè®®å’Œé¢„æµ‹

### 4. å†å²è®°å½•æ¨¡å—

#### 4.1 è®°å½•åˆ—è¡¨
- åˆ†é¡µæ˜¾ç¤ºå†å²è®°å½•
- æœç´¢åŠŸèƒ½ï¼ˆæŒ‰é—®é¢˜å†…å®¹ï¼‰
- æŒ‰æ—¶é—´å€’åºæ’åˆ—

#### 4.2 è®°å½•è¯¦æƒ…
- å®Œæ•´å¦è±¡ä¿¡æ¯å±•ç¤º
- AIè§£æå†…å®¹æŸ¥çœ‹
- æ”¯æŒé‡æ–°è§£æ

#### 4.3 è®°å½•ç®¡ç†
- åˆ é™¤å•æ¡è®°å½•
- æ‰¹é‡åˆ é™¤åŠŸèƒ½
- å¯¼å‡ºè®°å½•ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰

---

## æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“ä¿¡æ¯

- **æ•°æ®åº“å**: `liuyao_db`
- **å­—ç¬¦é›†**: `utf8mb4`
- **æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`
- **å­˜å‚¨å¼•æ“**: InnoDB

### è¡¨ç»“æ„è®¾è®¡

#### 1. divination_records (å¦è±¡è®°å½•è¡¨)

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | VARCHAR(50) | PRIMARY KEY | è®°å½•å”¯ä¸€æ ‡è¯† |
| timestamp | BIGINT | NOT NULL | èµ·å¦æ—¶é—´æˆ³ |
| question | TEXT | NOT NULL | å é—®äº‹é¡¹ |
| method | VARCHAR(20) | NOT NULL | èµ·å¦æ–¹å¼(time/number/manual) |
| ben_gua | TEXT | NOT NULL | æœ¬å¦æ•°æ®(JSON) |
| bian_gua | TEXT | NULL | å˜å¦æ•°æ®(JSON) |
| decoration | TEXT | NOT NULL | è£…å¦ä¿¡æ¯(JSON) |
| ai_analysis | TEXT | NULL | AIè§£æå†…å®¹ |
| created_at | TIMESTAMP | DEFAULT NOW | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•**:
- `idx_timestamp` - æ—¶é—´æˆ³ç´¢å¼•
- `idx_method` - èµ·å¦æ–¹å¼ç´¢å¼•
- `idx_created_at` - åˆ›å»ºæ—¶é—´ç´¢å¼•

**JSONæ•°æ®ç»“æ„**:

```typescript
// ben_gua å’Œ bian_gua ç»“æ„
{
  "name": "ä¹¾ä¸ºå¤©",
  "lines": [1,1,1,1,1,1],
  "changes": [false,false,false,false,true,false],
  "trigrams": {
    "upper": "ä¹¾",
    "lower": "ä¹¾"
  }
}

// decoration ç»“æ„
{
  "earthBranches": ["å­","å¯…","è¾°","åˆ","ç”³","æˆŒ"],
  "sixRelatives": ["çˆ¶æ¯","å…„å¼Ÿ","å®˜é¬¼","çˆ¶æ¯","å¦»è´¢","å­å­™"],
  "fiveElements": ["é‡‘","é‡‘","é‡‘","é‡‘","é‡‘","é‡‘"],
  "heavenlyStems": ["ç”²","ç”²","ç”²","å£¬","å£¬","å£¬"],
  "sixSpirits": ["é’é¾™","æœ±é›€","å‹¾é™ˆ","è£è›‡","ç™½è™","ç„æ­¦"],
  "shiYing": [3,0]
}
```

#### 2. trigrams (å…«å¦åŸºç¡€æ•°æ®è¡¨)

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | INT | PRIMARY KEY AUTO_INCREMENT | ä¸»é”®ID |
| name | VARCHAR(50) | NOT NULL UNIQUE | å¦å |
| symbol | VARCHAR(50) | NOT NULL | å¦ç¬¦(â˜°â˜±â˜²â˜³â˜´â˜µâ˜¶â˜·) |
| nature | VARCHAR(50) | NOT NULL | å¦è±¡å±æ€§ |
| element | VARCHAR(50) | NOT NULL | äº”è¡Œå±æ€§ |
| number | INT | NOT NULL UNIQUE | å¦åºå·(1-8) |

**æ•°æ®å†…å®¹**:
- ä¹¾(å¤©/é‡‘)ã€å…‘(æ³½/é‡‘)ã€ç¦»(ç«/ç«)ã€éœ‡(é›·/æœ¨)
- å·½(é£/æœ¨)ã€å(æ°´/æ°´)ã€è‰®(å±±/åœŸ)ã€å¤(åœ°/åœŸ)

#### 3. gua_data (å…­åå››å¦æ•°æ®è¡¨)

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| number | INT | PRIMARY KEY | å¦åºå·(1-64) |
| name | VARCHAR(20) | NOT NULL UNIQUE | å¦å |
| upper_trigram | VARCHAR(10) | NOT NULL | ä¸Šå¦åç§° |
| lower_trigram | VARCHAR(10) | NOT NULL | ä¸‹å¦åç§° |
| gua_ci | TEXT | NOT NULL | å¦è¾ |
| yao_ci | TEXT | NOT NULL | çˆ»è¾(JSONæ•°ç»„) |

**ç´¢å¼•**:
- `idx_trigrams` - ä¸Šä¸‹å¦ç»„åˆç´¢å¼•

**æ•°æ®ç¤ºä¾‹**:
```sql
{
  number: 1,
  name: "ä¹¾ä¸ºå¤©",
  upper_trigram: "ä¹¾",
  lower_trigram: "ä¹¾",
  gua_ci: "å…ƒäº¨åˆ©è´",
  yao_ci: ["åˆä¹:æ½œé¾™å‹¿ç”¨", "ä¹äºŒ:è§é¾™åœ¨ç”°,åˆ©è§å¤§äºº", ...]
}
```

### ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ divination_records  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚
â”‚ timestamp           â”‚
â”‚ question            â”‚
â”‚ method              â”‚
â”‚ ben_gua             â”‚
â”‚ bian_gua            â”‚
â”‚ decoration          â”‚
â”‚ ai_analysis         â”‚
â”‚ created_at          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ trigrams            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)             â”‚
â”‚ name (UK)           â”‚
â”‚ symbol              â”‚
â”‚ nature              â”‚
â”‚ element             â”‚
â”‚ number (UK)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gua_data            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ number (PK)         â”‚
â”‚ name (UK)           â”‚
â”‚ upper_trigram       â”‚
â”‚ lower_trigram       â”‚
â”‚ gua_ci              â”‚
â”‚ yao_ci              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:5000/api`
- **Content-Type**: `application/json`
- **å­—ç¬¦ç¼–ç **: UTF-8

### æ¥å£åˆ—è¡¨

#### 1. åˆ›å»ºå¦è±¡

**æ¥å£**: `POST /divination`

**æè¿°**: æ ¹æ®èµ·å¦ä¿¡æ¯åˆ›å»ºæ–°çš„å¦è±¡è®°å½•

**è¯·æ±‚ä½“**:
```json
{
  "question": "ä»Šå¹´äº‹ä¸šå‘å±•å¦‚ä½•ï¼Ÿ",
  "method": "time",
  "numbers": [12, 34, 56],  // methodä¸ºnumberæ—¶å¿…å¡«
  "yaoResults": [8, 6, 7, 9, 7, 8]  // methodä¸ºmanualæ—¶å¿…å¡«
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": "uuid-string",
    "timestamp": 1699876543000,
    "question": "ä»Šå¹´äº‹ä¸šå‘å±•å¦‚ä½•ï¼Ÿ",
    "method": "time",
    "benGua": {
      "name": "ä¹¾ä¸ºå¤©",
      "lines": [1,1,1,1,1,1],
      "changes": [false,false,false,false,true,false],
      "trigrams": {"upper": "ä¹¾", "lower": "ä¹¾"}
    },
    "bianGua": {...},
    "decoration": {...}
  }
}
```

#### 2. æ¨¡æ‹Ÿæ‘‡å¦

**æ¥å£**: `GET /divination/simulate`

**æè¿°**: æ¨¡æ‹Ÿä¸€æ¬¡æ‘‡å¦ï¼Œè¿”å›6/7/8/9ä¸­çš„ä¸€ä¸ªæ•°å­—

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "value": 8,  // 6-è€é˜´Ã—, 7-å°‘é˜³â€”, 8-å°‘é˜´--, 9-è€é˜³â—‹
    "description": "å°‘é˜´"
  }
}
```

#### 3. è·å–å†å²è®°å½•åˆ—è¡¨

**æ¥å£**: `GET /records`

**æè¿°**: è·å–æ‰€æœ‰å†å²å¦è±¡è®°å½•

**æŸ¥è¯¢å‚æ•°**:
- `search` (å¯é€‰): æœç´¢å…³é”®è¯
- `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤1
- `pageSize` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "records": [
      {
        "id": "uuid",
        "timestamp": 1699876543000,
        "question": "é—®é¢˜å†…å®¹",
        "method": "time",
        "benGua": {...},
        "bianGua": {...},
        "decoration": {...},
        "aiAnalysis": "è§£æå†…å®¹",
        "created_at": "2024-01-15T10:30:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 20
  }
}
```

#### 4. è·å–å•æ¡è®°å½•

**æ¥å£**: `GET /records/:id`

**æè¿°**: æ ¹æ®IDè·å–å•æ¡å¦è±¡è®°å½•è¯¦æƒ…

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "timestamp": 1699876543000,
    "question": "é—®é¢˜å†…å®¹",
    "method": "time",
    "benGua": {...},
    "bianGua": {...},
    "decoration": {...},
    "aiAnalysis": "å®Œæ•´è§£æå†…å®¹",
    "created_at": "2024-01-15T10:30:00Z"
  }
}
```

#### 5. æ›´æ–°AIè§£æ

**æ¥å£**: `PUT /records/:id/analysis`

**æè¿°**: æ›´æ–°æŒ‡å®šè®°å½•çš„AIè§£æå†…å®¹

**è¯·æ±‚ä½“**:
```json
{
  "aiAnalysis": "æ–°çš„AIè§£æå†…å®¹..."
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "AIè§£æå·²æ›´æ–°"
}
```

#### 6. åˆ é™¤è®°å½•

**æ¥å£**: `DELETE /records/:id`

**æè¿°**: åˆ é™¤æŒ‡å®šçš„å¦è±¡è®°å½•

**å“åº”**:
```json
{
  "success": true,
  "message": "è®°å½•å·²åˆ é™¤"
}
```

#### 7. AIæ™ºèƒ½è§£å¦

**æ¥å£**: `POST /ai/analyze`

**æè¿°**: ä½¿ç”¨AIå¯¹å¦è±¡è¿›è¡Œæ™ºèƒ½è§£æï¼ˆæµå¼å“åº”ï¼‰

**è¯·æ±‚ä½“**:
```json
{
  "recordId": "uuid-string",
  "question": "é—®é¢˜å†…å®¹",
  "benGua": {...},
  "bianGua": {...},
  "decoration": {...}
}
```

**å“åº”**: Server-Sent Events (SSE) æµå¼å“åº”
```
data: {"type":"start","message":"å¼€å§‹è§£æ..."}

data: {"type":"chunk","content":"æ­¤å¦ä¸ºä¹¾ä¸ºå¤©..."}

data: {"type":"chunk","content":"äº”çˆ»å‘åŠ¨..."}

data: {"type":"end","message":"è§£æå®Œæˆ"}
```

### é”™è¯¯å“åº”

æ‰€æœ‰æ¥å£ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼:

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "é”™è¯¯æè¿°ä¿¡æ¯"
  }
}
```

å¸¸è§é”™è¯¯ç :
- `400` - è¯·æ±‚å‚æ•°é”™è¯¯
- `404` - èµ„æºä¸å­˜åœ¨
- `500` - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
- `503` - DeepSeek APIä¸å¯ç”¨

---

## å‰ç«¯ç»„ä»¶è¯´æ˜

### é¡µé¢ç»„ä»¶

#### 1. Home.tsx - èµ·å¦é¡µé¢

**è·¯å¾„**: `/client/src/pages/Home.tsx`

**åŠŸèƒ½**:
- ä¸‰ç§èµ·å¦æ–¹å¼åˆ‡æ¢
- èµ·å¦è¡¨å•è¾“å…¥å’ŒéªŒè¯
- æ‘‡å¦åŠ¨ç”»æ•ˆæœ
- èµ·å¦ç»“æœæäº¤

**ä¸»è¦çŠ¶æ€**:
```typescript
const [method, setMethod] = useState<DivinationMethod>('time');
const [question, setQuestion] = useState('');
const [numbers, setNumbers] = useState([0, 0, 0]);
const [yaoResults, setYaoResults] = useState<number[]>([]);
```

#### 2. PaiĞ¿an.tsx - æ’ç›˜é¡µé¢

**è·¯å¾„**: `/client/src/pages/Paipan.tsx`

**åŠŸèƒ½**:
- æ˜¾ç¤ºæœ¬å¦å’Œå˜å¦ä¿¡æ¯
- å±•ç¤ºè£…å¦è¯¦ç»†æ•°æ®
- AIè§£å¦æŒ‰é’®å’Œç»“æœå±•ç¤º
- ä¿å­˜åˆ°å†å²è®°å½•

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
const handleAIAnalyze = async () => {
  // æµå¼æ¥æ”¶AIè§£æ
  const eventSource = new EventSource(url);
  eventSource.onmessage = (event) => {
    // å¤„ç†æµå¼æ•°æ®
  };
};
```

#### 3. History.tsx - å†å²è®°å½•é¡µé¢

**è·¯å¾„**: `/client/src/pages/History.tsx`

**åŠŸèƒ½**:
- è®°å½•åˆ—è¡¨å±•ç¤º
- æœç´¢å’Œç­›é€‰
- è®°å½•è¯¦æƒ…æŸ¥çœ‹
- åˆ é™¤è®°å½•

**ç»„ä»¶æ ‘**:
```
History
â”œâ”€â”€ SearchBar
â”œâ”€â”€ RecordList
â”‚   â””â”€â”€ RecordCard
â”‚       â”œâ”€â”€ GuaInfo
â”‚       â””â”€â”€ ActionButtons
â””â”€â”€ Pagination
```

### é€šç”¨ç»„ä»¶

#### 1. GuaDisplay - å¦è±¡å±•ç¤ºç»„ä»¶

**è·¯å¾„**: `/client/src/components/GuaDisplay.tsx`

**Props**:
```typescript
interface GuaDisplayProps {
  gua: Gua;
  decoration: GuaDecoration;
  title: string;
  showChanges?: boolean;
}
```

**åŠŸèƒ½**:
- å…­çˆ»å †å å±•ç¤º
- è£…å¦ä¿¡æ¯æ ‡æ³¨
- åŠ¨çˆ»æ ‡è®°
- ä¸–åº”ä½ç½®

#### 2. YaoLine - çˆ»ä½ç»„ä»¶

**è·¯å¾„**: `/client/src/components/YaoLine.tsx`

**Props**:
```typescript
interface YaoLineProps {
  type: YaoType;  // 0-é˜´ 1-é˜³
  isChanging: boolean;  // æ˜¯å¦ä¸ºåŠ¨çˆ»
  earthBranch: string;
  sixRelative: string;
  fiveElement: string;
  heavenlyStem: string;
  sixSpirit: string;
  position: 'shi' | 'ying' | null;
}
```

#### 3. LoadingSpinner - åŠ è½½ç»„ä»¶

ç®€å•çš„åŠ è½½åŠ¨ç”»ç»„ä»¶ï¼Œç”¨äºå¼‚æ­¥æ“ä½œæç¤ºã€‚

### å·¥å…·å‡½æ•°

#### 1. api.ts - APIè¯·æ±‚å°è£…

**è·¯å¾„**: `/client/src/utils/api.ts`

```typescript
export const api = {
  divination: {
    create: (data) => axios.post('/api/divination', data),
    simulate: () => axios.get('/api/divination/simulate'),
  },
  records: {
    list: (params) => axios.get('/api/records', { params }),
    get: (id) => axios.get(`/api/records/${id}`),
    delete: (id) => axios.delete(`/api/records/${id}`),
  },
  ai: {
    analyze: (data) => axios.post('/api/ai/analyze', data),
  },
};
```

---

## å®‰è£…ä¸éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚

#### æœ€ä½é…ç½®
- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0
- **MySQL**: >= 5.7 (æˆ– SQLite3)
- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.15+, Ubuntu 20.04+

#### æ¨èé…ç½®
- **Node.js**: 20.x LTS
- **MySQL**: 8.0+
- **å†…å­˜**: 2GB+
- **ç£ç›˜**: 500MB+

### å¼€å‘ç¯å¢ƒå®‰è£…

#### 1. å…‹éš†é¡¹ç›®

```bash
cd lt
```

#### 2. å®‰è£…ä¾èµ–

**æ–¹å¼ä¸€: ä¸€é”®å®‰è£…**
```bash
npm run install:all
```

**æ–¹å¼äºŒ: åˆ†åˆ«å®‰è£…**
```bash
# æ ¹ç›®å½•ä¾èµ–
npm install

# å‰ç«¯ä¾èµ–
cd client
npm install

# åç«¯ä¾èµ–
cd ../server
npm install
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `server` ç›®å½•åˆ›å»º `.env` æ–‡ä»¶:

```env
# æœåŠ¡å™¨é…ç½®
PORT=5000
NODE_ENV=development

# DeepSeek APIé…ç½®
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com

# æ•°æ®åº“é…ç½®ï¼ˆMySQLï¼‰
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=123456
DB_NAME=liuyao_db

# æ•°æ®åº“é…ç½®ï¼ˆSQLite - å¼€å‘ç¯å¢ƒé»˜è®¤ï¼‰
# DB_TYPE=sqlite
# DB_PATH=./data/liuyao.db
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“

**ä½¿ç”¨MySQL**:

```bash
cd server

# Windows
setup_mysql.bat

# Linux/Mac
chmod +x setup_mysql.sh
./setup_mysql.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
mysql -u root -p123456 < sql/init_database.sql
mysql -u root -p123456 < sql/insert_data.sql
mysql -u root -p123456 < sql/test_data.sql
```

**ä½¿ç”¨SQLite** (é»˜è®¤):
æ•°æ®åº“ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºã€‚

#### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**æ–¹å¼ä¸€: åŒæ—¶å¯åŠ¨å‰åç«¯**
```bash
# åœ¨æ ¹ç›®å½•
npm run dev
```

**æ–¹å¼äºŒ: åˆ†åˆ«å¯åŠ¨**
```bash
# ç»ˆç«¯1 - å¯åŠ¨åç«¯ (http://localhost:5000)
cd server
npm run dev

# ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯ (http://localhost:3000)
cd client
npm run dev
```

è®¿é—® `http://localhost:3000` å¼€å§‹ä½¿ç”¨ã€‚

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 1. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºå‰ç«¯
cd client
npm run build

# æ„å»ºåç«¯
cd ../server
npm run build
```

#### 2. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡

ç¼–è¾‘ `server/.env`:
```env
NODE_ENV=production
PORT=5000
DEEPSEEK_API_KEY=your_production_api_key
DB_TYPE=mysql
DB_HOST=your_db_host
# ... å…¶ä»–é…ç½®
```

#### 3. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

```bash
cd server
npm start
```

#### 4. ä½¿ç”¨PM2è¿›è¡Œè¿›ç¨‹ç®¡ç†

```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
cd server
pm2 start dist/index.js --name liuyao-server

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs liuyao-server

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### 5. Nginxåå‘ä»£ç†é…ç½®

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/lt/client/dist;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### Dockeréƒ¨ç½²

#### Dockerfile (Server)

```dockerfile
FROM node:20-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 5000

CMD ["npm", "start"]
```

#### docker-compose.yml

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123456
      MYSQL_DATABASE: liuyao_db
    volumes:
      - mysql_data:/var/lib/mysql
      - ./server/sql:/docker-entrypoint-initdb.d
    ports:
      - "3306:3306"

  server:
    build: ./server
    ports:
      - "5000:5000"
    environment:
      DB_TYPE: mysql
      DB_HOST: mysql
      DB_USER: root
      DB_PASSWORD: 123456
      DB_NAME: liuyao_db
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
    depends_on:
      - mysql

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./client/dist:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - server

volumes:
  mysql_data:
```

å¯åŠ¨:
```bash
docker-compose up -d
```

---

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
lt/
â”œâ”€â”€ client/                          # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/              # å¯å¤ç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ GuaDisplay.tsx       # å¦è±¡å±•ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ YaoLine.tsx          # çˆ»ä½ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.tsx   # åŠ è½½åŠ¨ç”»
â”‚   â”‚   â”œâ”€â”€ pages/                   # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.tsx             # èµ·å¦é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Paipan.tsx           # æ’ç›˜é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ History.tsx          # å†å²è®°å½•
â”‚   â”‚   â”œâ”€â”€ types/                   # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ api.ts               # APIè¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ styles/                  # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ index.css            # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ App.tsx                  # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.tsx                 # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ index.html                   # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ package.json                 # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ vite.config.ts              # Viteé…ç½®
â”‚   â”œâ”€â”€ tailwind.config.js          # Tailwindé…ç½®
â”‚   â””â”€â”€ tsconfig.json               # TSé…ç½®
â”‚
â”œâ”€â”€ server/                          # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/             # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ divinationController.ts  # èµ·å¦æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ aiController.ts          # AIæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”‚   â””â”€â”€ database.ts          # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±å±‚
â”‚   â”‚   â”‚   â””â”€â”€ index.ts             # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.ts         # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ liuyao.ts            # å…­çˆ»ç®—æ³•
â”‚   â”‚   â””â”€â”€ index.ts                 # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ sql/                         # SQLè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init_database.sql        # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ insert_data.sql          # åŸºç¡€æ•°æ®
â”‚   â”‚   â”œâ”€â”€ test_data.sql            # æµ‹è¯•æ•°æ®
â”‚   â”‚   â””â”€â”€ README.md                # SQLæ–‡æ¡£
â”‚   â”œâ”€â”€ data/                        # æ•°æ®åº“æ–‡ä»¶(SQLite)
â”‚   â”œâ”€â”€ dist/                        # ç¼–è¯‘è¾“å‡º
â”‚   â”œâ”€â”€ package.json                 # ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json               # TSé…ç½®
â”‚   â”œâ”€â”€ setup_mysql.bat             # Windowså®‰è£…è„šæœ¬
â”‚   â””â”€â”€ setup_mysql.sh              # Unixå®‰è£…è„šæœ¬
â”‚
â”œâ”€â”€ package.json                     # æ ¹ä¾èµ–é…ç½®
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
â””â”€â”€ QUICKSTART.md                    # å¿«é€Ÿå¼€å§‹
```

### ä»£ç è§„èŒƒ

#### TypeScriptè§„èŒƒ

```typescript
// ä½¿ç”¨æ¥å£å®šä¹‰ç±»å‹
interface User {
  id: string;
  name: string;
  email?: string;  // å¯é€‰å±æ€§
}

// ä½¿ç”¨ç±»å‹åˆ«åå®šä¹‰è”åˆç±»å‹
type Status = 'pending' | 'success' | 'error';

// å‡½æ•°ç±»å‹æ³¨è§£
function calculateGua(year: number, month: number): number {
  return (year + month) % 8;
}

// ç®­å¤´å‡½æ•°
const formatDate = (timestamp: number): string => {
  return new Date(timestamp).toISOString();
};
```

#### å‘½åè§„èŒƒ

- **æ–‡ä»¶å**: PascalCase (ç»„ä»¶) æˆ– camelCase (å·¥å…·)
  - `GuaDisplay.tsx`
  - `apiClient.ts`
- **ç»„ä»¶å**: PascalCase
  - `function GuaDisplay() {}`
- **å˜é‡å**: camelCase
  - `const benGua = ...`
- **å¸¸é‡å**: UPPER_SNAKE_CASE
  - `const MAX_RECORDS = 100`
- **ç±»å‹å**: PascalCase
  - `interface DivinationRecord {}`

#### æ³¨é‡Šè§„èŒƒ

```typescript
/**
 * è®¡ç®—å¦è±¡
 * @param year - å¹´ä»½
 * @param month - æœˆä»½
 * @param day - æ—¥æœŸ
 * @returns å¦è±¡æ•°å­—(1-8)
 */
function calculateGua(year: number, month: number, day: number): number {
  // å®ç°é€»è¾‘
  return (year + month + day) % 8;
}
```

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. æ·»åŠ æ–°çš„èµ·å¦æ–¹å¼

**æ­¥éª¤**:

1. åœ¨ `types/index.ts` æ·»åŠ æ–°æ–¹æ³•ç±»å‹:
```typescript
export type DivinationMethod = 'time' | 'number' | 'manual' | 'custom';
```

2. åœ¨ `server/src/utils/liuyao.ts` æ·»åŠ ç®—æ³•:
```typescript
export function customMethod(params: CustomParams): GuaResult {
  // å®ç°æ–°çš„èµ·å¦ç®—æ³•
}
```

3. åœ¨ `server/src/controllers/divinationController.ts` æ·»åŠ å¤„ç†:
```typescript
case 'custom':
  result = customMethod(req.body.customParams);
  break;
```

4. åœ¨ `client/src/pages/Home.tsx` æ·»åŠ UI:
```tsx
{method === 'custom' && (
  <CustomMethodForm onSubmit={handleSubmit} />
)}
```

#### 2. æ·»åŠ æ–°çš„APIæ¥å£

**æ­¥éª¤**:

1. åœ¨ `server/src/controllers/` åˆ›å»ºæ–°æ§åˆ¶å™¨
2. åœ¨ `server/src/routes/index.ts` æ³¨å†Œè·¯ç”±:
```typescript
router.post('/custom-endpoint', customController.handler);
```

3. åœ¨ `client/src/utils/api.ts` æ·»åŠ è¯·æ±‚æ–¹æ³•:
```typescript
export const api = {
  // ...
  custom: {
    action: (data) => axios.post('/api/custom-endpoint', data),
  },
};
```

#### 3. è‡ªå®šä¹‰æ ·å¼ä¸»é¢˜

ç¼–è¾‘ `client/tailwind.config.js`:
```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        'custom-red': '#B91C1C',
        'custom-green': '#047857',
      },
      fontFamily: {
        'custom': ['CustomFont', 'serif'],
      },
    },
  },
};
```

### è°ƒè¯•æŠ€å·§

#### åç«¯è°ƒè¯•

1. **ä½¿ç”¨console.log**:
```typescript
console.log('[DEBUG] å¦è±¡æ•°æ®:', guaData);
```

2. **ä½¿ç”¨VS Codeè°ƒè¯•å™¨**:

`.vscode/launch.json`:
```json
{
  "type": "node",
  "request": "launch",
  "name": "Debug Server",
  "program": "${workspaceFolder}/server/src/index.ts",
  "runtimeArgs": ["-r", "ts-node/register"],
  "env": {
    "NODE_ENV": "development"
  }
}
```

#### å‰ç«¯è°ƒè¯•

1. **React DevTools**: å®‰è£…æµè§ˆå™¨æ‰©å±•
2. **Consoleè°ƒè¯•**: ä½¿ç”¨ `console.log`
3. **Source Maps**: Viteè‡ªåŠ¨ç”Ÿæˆ

---

## æµ‹è¯•è¯´æ˜

### æ•°æ®åº“æµ‹è¯•

å·²æä¾›æµ‹è¯•æ•°æ®è„šæœ¬ï¼ŒåŒ…å«5æ¡å®Œæ•´çš„å¦è±¡è®°å½•:

```bash
mysql -u root -p123456 < server/sql/test_data.sql
```

**æµ‹è¯•æ•°æ®åŒ…å«**:
- æ—¶é—´èµ·å¦ç¤ºä¾‹
- æ•°å­—èµ·å¦ç¤ºä¾‹
- æ‰‹åŠ¨æ‘‡å¦ç¤ºä¾‹
- æœ‰å˜å¦å’Œæ— å˜å¦çš„æƒ…å†µ
- å®Œæ•´çš„AIè§£æå†…å®¹

### APIæµ‹è¯•

#### ä½¿ç”¨Postmanæµ‹è¯•

1. **åˆ›å»ºå¦è±¡**:
```
POST http://localhost:5000/api/divination
Content-Type: application/json

{
  "question": "æµ‹è¯•é—®é¢˜",
  "method": "time"
}
```

2. **è·å–è®°å½•åˆ—è¡¨**:
```
GET http://localhost:5000/api/records?search=æµ‹è¯•
```

3. **AIè§£æ** (éœ€è¦æœ‰æ•ˆçš„API Key):
```
POST http://localhost:5000/api/ai/analyze
Content-Type: application/json

{
  "recordId": "test-record-001",
  "question": "æµ‹è¯•é—®é¢˜",
  "benGua": {...},
  "decoration": {...}
}
```

### åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] æ—¶é—´èµ·å¦åŠŸèƒ½æ­£å¸¸
- [ ] æ•°å­—èµ·å¦åŠŸèƒ½æ­£å¸¸
- [ ] æ‰‹åŠ¨æ‘‡å¦åŠŸèƒ½æ­£å¸¸
- [ ] æ’ç›˜ä¿¡æ¯æ˜¾ç¤ºå®Œæ•´
- [ ] AIè§£ææµå¼å“åº”æ­£å¸¸
- [ ] å†å²è®°å½•ä¿å­˜å’ŒæŸ¥è¯¢æ­£å¸¸
- [ ] è®°å½•åˆ é™¤åŠŸèƒ½æ­£å¸¸
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] é”™è¯¯å¤„ç†å‹å¥½

---

## å¸¸è§é—®é¢˜

### 1. å®‰è£…é—®é¢˜

**Q: npm installå¤±è´¥**

A: å°è¯•ä»¥ä¸‹æ–¹æ³•:
```bash
# æ¸…é™¤ç¼“å­˜
npm cache clean --force

# ä½¿ç”¨å›½å†…é•œåƒ
npm config set registry https://registry.npmmirror.com

# é‡æ–°å®‰è£…
npm install
```

**Q: MySQLè¿æ¥å¤±è´¥**

A: æ£€æŸ¥:
- MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- ç«¯å£3306æ˜¯å¦è¢«å ç”¨
- é˜²ç«å¢™æ˜¯å¦å…è®¸è¿æ¥

### 2. è¿è¡Œé—®é¢˜

**Q: ç«¯å£è¢«å ç”¨**

A: ä¿®æ”¹ç«¯å£é…ç½®:
```env
# server/.env
PORT=5001

# client/vite.config.ts
server: { port: 3001 }
```

**Q: DeepSeek APIè°ƒç”¨å¤±è´¥**

A: æ£€æŸ¥:
- API Keyæ˜¯å¦æœ‰æ•ˆ
- ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
- APIé…é¢æ˜¯å¦å……è¶³
- è¯·æ±‚æ ¼å¼æ˜¯å¦æ­£ç¡®

### 3. æ•°æ®åº“é—®é¢˜

**Q: å­—ç¬¦é›†ä¹±ç **

A: ç¡®ä¿æ•°æ®åº“å’Œè¡¨ä½¿ç”¨utf8mb4:
```sql
ALTER DATABASE liuyao_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE trigrams CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**Q: æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥**

A: æ‰‹åŠ¨æ‰§è¡ŒSQL:
```bash
# åˆ é™¤æ—§æ•°æ®åº“
mysql -u root -p123456 -e "DROP DATABASE IF EXISTS liuyao_db;"

# é‡æ–°åˆå§‹åŒ–
mysql -u root -p123456 < server/sql/init_database.sql
mysql -u root -p123456 < server/sql/insert_data.sql
```

### 4. åŠŸèƒ½é—®é¢˜

**Q: åŠ¨çˆ»ä¸æ˜¾ç¤º**

A: æ£€æŸ¥:
- èµ·å¦ç®—æ³•æ˜¯å¦æ­£ç¡®ç”Ÿæˆchangesæ•°ç»„
- GuaDisplayç»„ä»¶æ˜¯å¦æ­£ç¡®ä¼ å…¥changeså±æ€§
- æ ·å¼æ˜¯å¦æ­£ç¡®åº”ç”¨

**Q: AIè§£ææ²¡æœ‰å†…å®¹**

A: æ£€æŸ¥:
- DeepSeek API Keyé…ç½®
- ç½‘ç»œè¿æ¥
- åç«¯æ—¥å¿—é”™è¯¯ä¿¡æ¯
- å‰ç«¯EventSourceç›‘å¬

---

## æœªæ¥è§„åˆ’

### çŸ­æœŸè®¡åˆ’ (v1.1)

- [ ] å®Œå–„64å¦å®Œæ•´æ•°æ®
- [ ] æ·»åŠ å¦è±¡åˆ†äº«åŠŸèƒ½
- [ ] æ”¯æŒå¯¼å‡ºPDFæŠ¥å‘Š
- [ ] æ·»åŠ ç”¨æˆ·ç³»ç»Ÿå’Œè®¤è¯
- [ ] ç§»åŠ¨ç«¯APPå¼€å‘

### ä¸­æœŸè®¡åˆ’ (v2.0)

- [ ] å¤šAIæ¨¡å‹æ”¯æŒ(ChatGPT, Claudeç­‰)
- [ ] é«˜çº§ç­›é€‰å’Œç»Ÿè®¡åŠŸèƒ½
- [ ] å…­çˆ»ç®—å‘½ç³»ç»Ÿ
- [ ] ç¤¾åŒºåŠŸèƒ½(è®¨è®ºã€è¯„è®º)
- [ ] å­¦ä¹ æ•™ç¨‹å’Œè§†é¢‘

### é•¿æœŸè®¡åˆ’ (v3.0)

- [ ] å…¶ä»–å åœç³»ç»Ÿé›†æˆ(æ¢…èŠ±æ˜“æ•°ã€å¥‡é—¨éç”²)
- [ ] å¤§æ•°æ®åˆ†æå’Œè¶‹åŠ¿é¢„æµ‹
- [ ] ä¸“å®¶ç³»ç»Ÿå’ŒçŸ¥è¯†å›¾è°±
- [ ] å›½é™…åŒ–å¤šè¯­è¨€æ”¯æŒ
- [ ] ä¼ä¸šçº§SaaSæœåŠ¡

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### å¦‚ä½•è´¡çŒ®

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹: `git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/AmazingFeature`
5. æäº¤Pull Request

### ä»£ç å®¡æŸ¥æ ‡å‡†

- ç¬¦åˆé¡¹ç›®ä»£ç è§„èŒƒ
- åŒ…å«å¿…è¦çš„æ³¨é‡Š
- é€šè¿‡æ‰€æœ‰æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## è®¸å¯è¯

MIT License - è¯¦è§LICENSEæ–‡ä»¶

---

## è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**: [GitHubä»“åº“]
- **é—®é¢˜åé¦ˆ**: [Issuesé¡µé¢]
- **é‚®ä»¶**: your-email@example.com

---

## è‡´è°¢

- **lunar-javascript**: å†œå†è½¬æ¢åº“
- **DeepSeek**: AIè§£å¦æ”¯æŒ
- **React**: å‰ç«¯æ¡†æ¶
- **Express**: åç«¯æ¡†æ¶
- **æ‰€æœ‰è´¡çŒ®è€…**

---

## å…è´£å£°æ˜

æœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ ã€ç ”ç©¶å’Œå¨±ä¹ä½¿ç”¨ã€‚å…­çˆ»å åœå±äºä¼ ç»Ÿæ–‡åŒ–èŒƒç•´ï¼Œä¸åº”ä½œä¸ºé‡å¤§å†³ç­–çš„å”¯ä¸€ä¾æ®ã€‚AIè§£æç»“æœä»…ä¾›å‚è€ƒï¼Œä¸ä»£è¡¨ä»»ä½•ç¡®å®šæ€§é¢„æµ‹ã€‚ä½¿ç”¨è€…åº”ç†æ€§å¯¹å¾…å åœç»“æœï¼Œå¹¶å¯¹è‡ªå·±çš„å†³ç­–è´Ÿè´£ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2024-01-15
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
